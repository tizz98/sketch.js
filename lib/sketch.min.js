var slice=[].slice;!function(t){var e;return t.fn.sketch=function(){var o,n,i;return n=arguments[0],o=2<=arguments.length?slice.call(arguments,1):[],this.length>1&&t.error("Sketch.js can only be called on one element at a time."),i=this.data("sketch"),"string"==typeof n&&i?i[n]?"function"==typeof i[n]?i[n].apply(i,o):0===o.length?i[n]:1===o.length?i[n]=o[0]:void 0:t.error("Sketch.js did not recognize the given command."):i?i:(this.data("sketch",new e(this.get(0),n)),this)},e=function(){function e(e,o){this.el=e,this.canvas=t(e),this.context=e.getContext("2d"),this.options=t.extend({toolLinks:!0,defaultTool:"marker",defaultColor:"#000000",defaultSize:5},o),this.painting=!1,this.color=this.options.defaultColor,this.size=this.options.defaultSize,this.tool=this.options.defaultTool,this.actions=[],this.action=[],this.canvas.bind("click mousedown mouseup mousemove mouseleave mouseout touchstart touchmove touchend touchcancel",this.onEvent),this.options.toolLinks&&t("body").delegate('a[href="#'+this.canvas.attr("id")+'"]',"click",function(){var e,o,n,i,s,a,h;for(o=t(this),e=t(o.attr("href")),h=e.data("sketch"),a=["color","size","tool"],n=0,s=a.length;s>n;n++)i=a[n],o.attr("data-"+i)&&h.set(i,t(this).attr("data-"+i));return t(this).attr("data-download")&&h.download(t(this).attr("data-download")),!1})}return e.prototype.download=function(t){var e;return t||(t="png"),"jpg"===t&&(t="jpeg"),e="image/"+t,window.open(this.el.toDataURL(e))},e.prototype.set=function(t,e){return this[t]=e,this.canvas.trigger("sketch.change"+t,e)},e.prototype.startPainting=function(){return this.painting=!0,this.action={tool:this.tool,color:this.color,size:parseFloat(this.size),events:[]}},e.prototype.stopPainting=function(){return this.action&&this.actions.push(this.action),this.painting=!1,this.action=null,this.redraw()},e.prototype.onEvent=function(e){return e.originalEvent&&e.originalEvent.targetTouches&&("touchend"===e.type?(e.pageX=e.originalEvent.pageX,e.pageY=e.originalEvent.pageY):(e.pageX=e.originalEvent.targetTouches[0].pageX,e.pageY=e.originalEvent.targetTouches[0].pageY)),t.sketch.tools[t(this).data("sketch").tool].onEvent.call(t(this).data("sketch"),e),e.preventDefault(),!1},e.prototype.redraw=function(){var e;return this.el.width=this.canvas.width(),this.context=this.el.getContext("2d"),e=this,t.each(this.actions,function(){return this.tool?t.sketch.tools[this.tool].draw.call(e,this):void 0}),this.painting&&this.action?t.sketch.tools[this.action.tool].draw.call(e,this.action):void 0},e}(),t.sketch={tools:{}},t.sketch.tools.marker={onEvent:function(t){switch(t.type){case"mousedown":case"touchstart":this.startPainting();break;case"mouseup":case"mouseout":case"mouseleave":case"touchend":case"touchcancel":this.stopPainting()}return this.painting?(this.action.events.push({x:t.pageX-this.canvas.offset().left,y:t.pageY-this.canvas.offset().top,event:t.type}),this.redraw()):void 0},draw:function(t){var e,o,n,i,s;for(this.context.lineJoin="round",this.context.lineCap="round",this.context.beginPath(),this.context.moveTo(t.events[0].x,t.events[0].y),s=t.events,o=0,n=s.length;n>o;o++)e=s[o],this.context.lineTo(e.x,e.y),i=e;return this.context.strokeStyle=t.color,this.context.lineWidth=t.size,this.context.stroke()}},t.sketch.tools.eraser={onEvent:function(e){return t.sketch.tools.marker.onEvent.call(this,e)},draw:function(e){var o;return o=this.context.globalCompositeOperation,this.context.globalCompositeOperation="destination-out",e.color="rgba(0,0,0,1)",t.sketch.tools.marker.draw.call(this,e),this.context.globalCompositeOperation=o}}}(jQuery);